# ============================================
# SEGURANÇA E REDIRECIONAMENTO
# Sistema MVC08 - Colégio São Gonçalo
# ============================================

# Desabilita listagem de diretórios
Options -Indexes

# Desabilita assinatura do servidor
ServerSignature Off

# Protege arquivos sensíveis
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protege arquivos de configuração
<FilesMatch "\.(env|json|lock|md|log|sql|sh|yml|yaml|ini|config)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protege composer
<FilesMatch "^composer\.(json|lock)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protege diretórios sensíveis
RedirectMatch 403 ^/(vendor|storage|database|app|routes)/.*$

# Redireciona para a pasta public
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Bloqueia acesso a arquivos sensíveis via URL
    RewriteRule ^\.env - [F,L]
    RewriteRule ^composer\.(json|lock) - [F,L]
    
    # Redireciona para public
    RewriteRule ^$ public/ [L]
    RewriteRule (.*) public/$1 [L]
</IfModule>

# Proteção contra injeção de código
<IfModule mod_rewrite.c>
    RewriteCond %{QUERY_STRING} (<|%3C).*script.*(>|%3E) [NC,OR]
    RewriteCond %{QUERY_STRING} GLOBALS(=|[|%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} _REQUEST(=|[|%[0-9A-Z]{0,2})
    RewriteRule ^(.*)$ index.php [F,L]
</IfModule>

# Limita tamanho de upload (ajuste conforme necessário)
php_value upload_max_filesize 10M
php_value post_max_size 10M

# Desabilita execução de PHP em diretórios de upload
<Directory "public/uploads">
    php_flag engine off
    <FilesMatch "\.php$">
        Order allow,deny
        Deny from all
    </FilesMatch>
</Directory>
